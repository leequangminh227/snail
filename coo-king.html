<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M√°y T√≠nh L·ª£i Nhu·∫≠n M√≥n ƒÇn</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 30px;
            font-size: 2.5em;
        }

        .section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .section h2 {
            color: #764ba2;
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        .input-group label {
            font-weight: 600;
            margin-bottom: 5px;
            color: #333;
        }

        .input-group input {
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .input-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        th, td {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid #ddd;
        }

        th {
            background: #667eea;
            color: white;
            font-weight: 600;
            position: sticky;
            top: 0;
        }

        tr:hover {
            background: #f1f3f5;
        }

        .profit-positive {
            color: #28a745;
            font-weight: 600;
        }

        .profit-negative {
            color: #dc3545;
            font-weight: 600;
        }

        .checkbox-cell {
            width: 50px;
        }

        input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        input[type="number"].price-input {
            width: 100px;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 3px;
            text-align: center;
        }

        .strategy-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .strategy-section h2 {
            color: white;
            margin-bottom: 20px;
        }

        .strategy-item {
            background: rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            backdrop-filter: blur(10px);
        }

        .strategy-item h3 {
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .strategy-item p {
            margin: 5px 0;
            line-height: 1.6;
        }

        .total-box {
            background: rgba(255, 255, 255, 0.95);
            color: #333;
            padding: 20px;
            border-radius: 10px;
            margin-top: 15px;
            text-align: center;
        }

        .total-box h3 {
            color: #667eea;
            font-size: 1.8em;
            margin-bottom: 10px;
        }

        .total-box .amount {
            font-size: 2.5em;
            font-weight: 700;
            color: #28a745;
        }

        .comparison {
            margin-top: 15px;
            font-size: 1.1em;
        }

        .badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
            margin-left: 5px;
        }

        .badge-best {
            background: #ffd700;
            color: #333;
        }

        .badge-good {
            background: #28a745;
            color: white;
        }

        .badge-bad {
            background: #dc3545;
            color: white;
        }

        .back-button {
            display: inline-block;
            padding: 10px 20px;
            background: #f8f9fa;
            color: #667eea;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s;
            border: 2px solid #667eea;
        }

        .back-button:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .reset-button {
            display: inline-block;
            padding: 10px 20px;
            background: #f8f9fa;
            color: #dc3545;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s;
            border: 2px solid #dc3545;
            cursor: pointer;
            font-family: inherit;
        }

        .reset-button:hover {
            background: #dc3545;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.4);
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            h1 {
                font-size: 1.8em;
            }

            table {
                font-size: 14px;
            }

            th, td {
                padding: 8px 4px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üç≥ Coo-king Calculator</h1>
        <div style="text-align: center; margin-bottom: 20px; display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
            <a href="/" class="back-button">‚Üê Quay l·∫°i trang ch·ªß</a>
            <button onclick="resetToDefault()" class="reset-button">üîÑ Reset v·ªÅ m·∫∑c ƒë·ªãnh</button>
        </div>

        <div class="section">
            <h2>üì¶ Nguy√™n Li·ªáu</h2>
            <div class="input-grid">
                <div class="input-group">
                    <label for="food1">Food 1 (65% t·ª∑ l·ªá r∆°i - Gi√° l·∫ª: 29)</label>
                    <input type="number" id="food1" value="650" min="0">
                </div>
                <div class="input-group">
                    <label for="food2">Food 2 (25% t·ª∑ l·ªá r∆°i - Gi√° l·∫ª: 86)</label>
                    <input type="number" id="food2" value="250" min="0">
                </div>
                <div class="input-group">
                    <label for="food3">Food 3 (10% t·ª∑ l·ªá r∆°i - Gi√° l·∫ª: 156)</label>
                    <input type="number" id="food3" value="100" min="0">
                </div>
            </div>
        </div>

        <div class="section">
            <h2>üçΩÔ∏è Danh S√°ch M√≥n ƒÇn</h2>
            <p style="text-align: center; color: #666; font-size: 0.9em; margin-bottom: 10px;">
                üíæ Tr·∫°ng th√°i checkbox v√† gi√° b√°n ƒë∆∞·ª£c t·ª± ƒë·ªông l∆∞u
            </p>
            <div class="table-container">
                <table id="dishTable">
                    <thead>
                        <tr>
                            <th>Ch·ªçn</th>
                            <th>STT</th>
                            <th>T√™n m√≥n</th>
                            <th>Food1</th>
                            <th>Food2</th>
                            <th>Food3</th>
                            <th>Gi√° b√°n</th>
                            <th>Chi ph√≠ c∆° h·ªôi</th>
                            <th>L·ª£i nhu·∫≠n</th>
                            <th>ƒê√°nh gi√°</th>
                        </tr>
                    </thead>
                    <tbody id="dishTableBody">
                        <!-- S·∫Ω ƒë∆∞·ª£c th√™m b·∫±ng JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>

        <div class="strategy-section">
            <h2>üí° Chi·∫øn L∆∞·ª£c T·ªëi ∆Øu</h2>
            <div id="strategyContent">
                <!-- S·∫Ω ƒë∆∞·ª£c th√™m b·∫±ng JavaScript -->
            </div>
        </div>
    </div>

    <script>
        // D·ªØ li·ªáu m√≥n ƒÉn
        const dishes = [
            { id: 1, name: 'S√¢u h·ªìi', food1: 1, food2: 0, food3: 0, price: 20 },
            { id: 2, name: 'Hamburger', food1: 3, food2: 0, food3: 0, price: 86 },
            { id: 3, name: 'Pudding', food1: 2, food2: 1, food3: 0, price: 154 },
            { id: 4, name: 'Salad', food1: 5, food2: 0, food3: 0, price: 192 },
            { id: 5, name: 'Gumball', food1: 3, food2: 2, food3: 0, price: 288 },
            { id: 6, name: 'Th·∫ßn l·∫±n', food1: 4, food2: 2, food3: 0, price: 364 },
            { id: 7, name: 'X∆∞∆°ng b√≤ ma', food1: 6, food2: 3, food3: 0, price: 590 },
            { id: 8, name: 'S√∫p ƒë·∫∑c m·∫Øt nh·ªán', food1: 5, food2: 2, food3: 1, price: 504 },
            { id: 9, name: 'Ph√¥ mai gi√≤i', food1: 10, food2: 6, food3: 0, price: 1258 },
            { id: 10, name: 'Tinh linh m√°u', food1: 8, food2: 4, food3: 0, price: 844 },
            { id: 11, name: 'Ch√¢n s∆∞ t·ª≠', food1: 8, food2: 5, food3: 3, price: 1008 },
            { id: 12, name: 'B√°nh quy pho m√°t', food1: 20, food2: 10, food3: 5, price: 2160 }
        ];

        // Gi√° b√°n l·∫ª nguy√™n li·ªáu
        const foodPrices = {
            food1: 29,
            food2: 86,
            food3: 156
        };

        // Load t·ª´ localStorage
        function loadFromLocalStorage() {
            const saved = localStorage.getItem('coo-king-dish-states');
            if (saved) {
                try {
                    const savedStates = JSON.parse(saved);
                    // Merge v·ªõi d·ªØ li·ªáu m·∫∑c ƒë·ªãnh (ƒë·ªÉ ƒë·∫£m b·∫£o c√≥ ƒë·∫ßy ƒë·ªß m√≥n)
                    return dishes.map(dish => {
                        const savedDish = savedStates.find(s => s.id === dish.id);
                        if (savedDish) {
                            return {
                                ...dish,
                                enabled: savedDish.enabled !== undefined ? savedDish.enabled : true,
                                price: savedDish.price !== undefined ? savedDish.price : dish.price
                            };
                        }
                        return { ...dish, enabled: true };
                    });
                } catch (e) {
                    console.error('L·ªói khi load localStorage:', e);
                    return dishes.map(d => ({ ...d, enabled: true }));
                }
            }
            return dishes.map(d => ({ ...d, enabled: true }));
        }

        // L∆∞u v√†o localStorage
        function saveToLocalStorage() {
            try {
                const statesToSave = dishStates.map(dish => ({
                    id: dish.id,
                    enabled: dish.enabled,
                    price: dish.price
                }));
                localStorage.setItem('coo-king-dish-states', JSON.stringify(statesToSave));
            } catch (e) {
                console.error('L·ªói khi l∆∞u localStorage:', e);
            }
        }

        // State
        let dishStates = loadFromLocalStorage();

        // Kh·ªüi t·∫°o b·∫£ng m√≥n ƒÉn
        function initDishTable() {
            const tbody = document.getElementById('dishTableBody');
            tbody.innerHTML = '';

            dishStates.forEach(dish => {
                const row = document.createElement('tr');
                const opportunityCost = calculateOpportunityCost(dish);
                const profit = dish.price - opportunityCost;
                const rating = getRating(profit);

                row.innerHTML = `
                    <td class="checkbox-cell">
                        <input type="checkbox" 
                               id="dish-${dish.id}" 
                               ${dish.enabled ? 'checked' : ''} 
                               onchange="toggleDish(${dish.id})">
                    </td>
                    <td>${dish.id}</td>
                    <td><strong>${dish.name}</strong></td>
                    <td>${dish.food1}</td>
                    <td>${dish.food2}</td>
                    <td>${dish.food3}</td>
                    <td>
                        <input type="number" 
                               class="price-input" 
                               value="${dish.price}" 
                               min="0" 
                               onchange="updatePrice(${dish.id}, this.value)">
                    </td>
                    <td>${opportunityCost.toFixed(0)}</td>
                    <td class="${profit >= 0 ? 'profit-positive' : 'profit-negative'}">
                        ${profit >= 0 ? '+' : ''}${profit.toFixed(0)}
                    </td>
                    <td>${rating}</td>
                `;
                tbody.appendChild(row);
            });
        }

        // T√≠nh chi ph√≠ c∆° h·ªôi
        function calculateOpportunityCost(dish) {
            return dish.food1 * foodPrices.food1 + 
                   dish.food2 * foodPrices.food2 + 
                   dish.food3 * foodPrices.food3;
        }

        // ƒê√°nh gi√° m√≥n ƒÉn
        function getRating(profit) {
            if (profit >= 400) return '<span class="badge badge-best">‚≠ê XU·∫§T S·∫ÆC</span>';
            if (profit >= 200) return '<span class="badge badge-good">‚úì‚úì‚úì R·∫•t t·ªët</span>';
            if (profit >= 100) return '<span class="badge badge-good">‚úì‚úì T·ªët</span>';
            if (profit >= 20) return '<span class="badge badge-good">‚úì Kh√°</span>';
            return '<span class="badge badge-bad">‚ùå T·ªá</span>';
        }

        // Toggle m√≥n ƒÉn
        function toggleDish(dishId) {
            const dish = dishStates.find(d => d.id === dishId);
            dish.enabled = !dish.enabled;
            saveToLocalStorage();
            calculate();
        }

        // C·∫≠p nh·∫≠t gi√°
        function updatePrice(dishId, newPrice) {
            const dish = dishStates.find(d => d.id === dishId);
            dish.price = parseFloat(newPrice) || 0;
            saveToLocalStorage();
            calculate();
        }

        // Reset v·ªÅ m·∫∑c ƒë·ªãnh
        function resetToDefault() {
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën reset t·∫•t c·∫£ v·ªÅ m·∫∑c ƒë·ªãnh? (Checkbox v√† gi√° b√°n s·∫Ω v·ªÅ tr·∫°ng th√°i ban ƒë·∫ßu)')) {
                localStorage.removeItem('coo-king-dish-states');
                dishStates = dishes.map(d => ({ ...d, enabled: true }));
                initDishTable();
                calculate();
                alert('ƒê√£ reset v·ªÅ m·∫∑c ƒë·ªãnh! ‚úÖ');
            }
        }

        // T√≠nh to√°n chi·∫øn l∆∞·ª£c t·ªëi ∆∞u
        function calculate() {
            // C·∫≠p nh·∫≠t l·∫°i b·∫£ng
            initDishTable();

            const food1 = parseInt(document.getElementById('food1').value) || 0;
            const food2 = parseInt(document.getElementById('food2').value) || 0;
            const food3 = parseInt(document.getElementById('food3').value) || 0;

            // T√≠nh t·ªïng gi√° b√°n l·∫ª
            const totalRetail = food1 * foodPrices.food1 + 
                               food2 * foodPrices.food2 + 
                               food3 * foodPrices.food3;

            // L·∫•y c√°c m√≥n ƒë∆∞·ª£c b·∫≠t
            const enabledDishes = dishStates.filter(d => d.enabled);

            // T√≠nh l·ª£i nhu·∫≠n cho m·ªói m√≥n
            const dishProfits = enabledDishes.map(dish => {
                const opportunityCost = calculateOpportunityCost(dish);
                const profit = dish.price - opportunityCost;
                return {
                    ...dish,
                    opportunityCost,
                    profit,
                    profitRatio: profit / opportunityCost
                };
            });

            // S·∫Øp x·∫øp theo l·ª£i nhu·∫≠n gi·∫£m d·∫ßn
            dishProfits.sort((a, b) => b.profit - a.profit);

            // T√¨m chi·∫øn l∆∞·ª£c t·ªëi ∆∞u b·∫±ng greedy algorithm
            let remainingFood1 = food1;
            let remainingFood2 = food2;
            let remainingFood3 = food3;
            let totalProfit = 0;
            let totalRevenueFromCooking = 0;
            const strategy = [];

            for (const dish of dishProfits) {
                if (dish.profit <= 0) continue; // B·ªè qua m√≥n l·ªó

                // T√≠nh s·ªë m√≥n c√≥ th·ªÉ n·∫•u
                let maxCook = Infinity;
                if (dish.food1 > 0) maxCook = Math.min(maxCook, Math.floor(remainingFood1 / dish.food1));
                if (dish.food2 > 0) maxCook = Math.min(maxCook, Math.floor(remainingFood2 / dish.food2));
                if (dish.food3 > 0) maxCook = Math.min(maxCook, Math.floor(remainingFood3 / dish.food3));

                if (maxCook > 0 && maxCook !== Infinity) {
                    const cookCount = maxCook;
                    const revenue = cookCount * dish.price;
                    const netProfit = cookCount * dish.profit;

                    remainingFood1 -= cookCount * dish.food1;
                    remainingFood2 -= cookCount * dish.food2;
                    remainingFood3 -= cookCount * dish.food3;
                    totalProfit += netProfit;
                    totalRevenueFromCooking += revenue;

                    strategy.push({
                        dish,
                        count: cookCount,
                        revenue,
                        netProfit
                    });
                }
            }

            // T√≠nh gi√° tr·ªã nguy√™n li·ªáu d∆∞
            const remainingValue = remainingFood1 * foodPrices.food1 +
                                  remainingFood2 * foodPrices.food2 +
                                  remainingFood3 * foodPrices.food3;

            const totalRevenue = totalRevenueFromCooking + remainingValue;
            const profitIncrease = totalRevenue - totalRetail;
            const profitPercent = totalRetail > 0 ? (profitIncrease / totalRetail * 100) : 0;

            // Hi·ªÉn th·ªã k·∫øt qu·∫£
            displayStrategy(strategy, remainingFood1, remainingFood2, remainingFood3, 
                          remainingValue, totalRevenueFromCooking, totalRevenue, totalRetail, profitIncrease, profitPercent);
        }

        // Hi·ªÉn th·ªã chi·∫øn l∆∞·ª£c
        function displayStrategy(strategy, remainingFood1, remainingFood2, remainingFood3, 
                                remainingValue, totalRevenueFromCooking, totalRevenue, totalRetail, profitIncrease, profitPercent) {
            const content = document.getElementById('strategyContent');
            
            if (strategy.length === 0) {
                content.innerHTML = `
                    <div class="strategy-item">
                        <h3>‚ö†Ô∏è Kh√¥ng c√≥ chi·∫øn l∆∞·ª£c l·ª£i nhu·∫≠n</h3>
                        <p>T·∫•t c·∫£ c√°c m√≥n ƒë·ªÅu l·ªó ho·∫∑c kh√¥ng ƒë·ªß nguy√™n li·ªáu. N√™n b√°n l·∫ª nguy√™n li·ªáu!</p>
                    </div>
                `;
            } else {
                let html = '<div class="strategy-item"><h3>üéØ Chi·∫øn L∆∞·ª£c N·∫•u ƒÇn T·ªëi ∆Øu:</h3>';
                
                strategy.forEach((item, index) => {
                    html += `
                        <p><strong>${index + 1}. ${item.dish.name}</strong>: 
                        N·∫•u <strong>${item.count} m√≥n</strong> 
                        ‚Üí Thu v·ªÅ <strong>${item.revenue.toFixed(0)}</strong> 
                        (L·ª£i nhu·∫≠n: <strong>+${item.netProfit.toFixed(0)}</strong>)</p>
                    `;
                });

                html += '</div>';

                html += `
                    <div class="strategy-item">
                        <h3>üìä Nguy√™n Li·ªáu C√≤n L·∫°i:</h3>
                        <p>Food1: <strong>${remainingFood1}</strong> (${(remainingFood1 * foodPrices.food1).toFixed(0)})</p>
                        <p>Food2: <strong>${remainingFood2}</strong> (${(remainingFood2 * foodPrices.food2).toFixed(0)})</p>
                        <p>Food3: <strong>${remainingFood3}</strong> (${(remainingFood3 * foodPrices.food3).toFixed(0)})</p>
                        <p>T·ªïng gi√° tr·ªã b√°n l·∫ª d∆∞: <strong>${remainingValue.toFixed(0)}</strong></p>
                    </div>
                `;

                content.innerHTML = html;
            }

            content.innerHTML += `
                <div class="total-box">
                    <h3>üí∞ T·ªîNG THU NH·∫¨P</h3>
                    <div class="amount">${totalRevenue.toFixed(0)}</div>
                    <div class="comparison">
                        <p>‚Ä¢ T·ªïng b√°n m√≥n ƒÉn: <strong>${totalRevenueFromCooking.toFixed(0)}</strong></p>
                        <p>‚Ä¢ T·ªïng gi√° tr·ªã nguy√™n li·ªáu c√≤n l·∫°i: <strong>${remainingValue.toFixed(0)}</strong></p>
                        <p style="border-top: 2px solid #ddd; padding-top: 10px; margin-top: 10px;">So v·ªõi b√°n l·∫ª to√†n b·ªô: <strong>${totalRetail.toFixed(0)}</strong></p>
                        <p style="font-size: 1.3em; color: ${profitIncrease >= 0 ? '#28a745' : '#dc3545'}">
                            ${profitIncrease >= 0 ? '‚úì' : '‚úó'} 
                            <strong>${profitIncrease >= 0 ? '+' : ''}${profitIncrease.toFixed(0)} 
                            (${profitIncrease >= 0 ? '+' : ''}${profitPercent.toFixed(1)}%)</strong>
                        </p>
                    </div>
                </div>
            `;
        }

        // Event listeners
        document.getElementById('food1').addEventListener('input', calculate);
        document.getElementById('food2').addEventListener('input', calculate);
        document.getElementById('food3').addEventListener('input', calculate);

        // Kh·ªüi t·∫°o
        initDishTable();
        calculate();
    </script>
</body>
</html>

